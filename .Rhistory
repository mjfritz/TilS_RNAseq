missing <- anno_table[missingnames, ]
tilSDesign <- allDesign[(allDesign$type %in% "tils"), ]
tilSMatrix <- allMatrix[ , rownames(tilSDesign)]
ppcDesign <- allDesign[(allDesign$type %in% "ppc") | (allDesign$strain == "WT"), ]
ppcMatrix <- allMatrix[ , rownames(ppcDesign)]
# Full data set: with and without chromosome 3
desOutFull <- des_workflow("results/DESeq2_Results_Full", allMatrix, "plmd", allDesign, anno_table)
doFull <- des_workflow("results/DESeq2_Results_Full_noChrom3", allMatrix, "both", allDesign , anno_table)
# TilS subset: with and without chromosome 3
desOutTilS <- des_workflow("results/DESeq2_Results_TilS", tilSMatrix, "plmd", tilSDesign, anno_table)
doTilS <- des_workflow("results/DESeq2_Results_TilS_noChrom3", tilSMatrix, "both", tilSDesign , anno_table)
# PPC subset: with and without chromosome 3
desOutPPC <- des_workflow("results/DESeq2_Results_PPC", ppcMatrix, "plmd", ppcDesign, anno_table)
doPPC <- des_workflow("results/DESeq2_Results_PPC_noChrom3", ppcMatrix, "both", ppcDesign , anno_table)
dds <- list(desOutFull[[1]], doFull[[1]], desOutTilS[[1]], doTilS[[1]], desOutPPC[[1]], doPPC[[1]])
desres <- list(desOutFull[[2]], doFull[[2]], desOutTilS[[2]], doTilS[[2]], desOutPPC[[2]], doPPC[[2]])
nameKey <- c("Full", "Full_nochr3", "TilS", "TilS_nochr3", "PPC", "PPC_nochr3")
names(dds) <- nameKey
names(desres) <- nameKey
rm(desOutFull, desOutTilS, desOutPPC, doFull, doTilS, doPPC) # Clean up
desresSig <- lapply(desres, function(matrixof) {
lapply(matrixof[ ,1], function(df) {
newdf <- df[order(df$pvalue), ]
newdf <- subset(newdf, padj<0.1)
newdf <- as.data.frame(newdf)
newdf <- tibble::rownames_to_column(newdf, var="Gene")
shortAno <- table_annotations2[table_annotations2$locusTag %in% newdf$Gene, ]
newdf$annotation <- shortAno$name
return (newdf)
})
})
desresSig <- lapply(desres, function(matrixof) {
lapply(matrixof[ ,1], function(df) {
newdf <- df[order(df$pvalue), ]
newdf <- subset(newdf, padj<0.1)
newdf <- as.data.frame(newdf)
newdf <- tibble::rownames_to_column(newdf, var="Gene")
shortAno <- anno_table[anno_table$locusTag %in% newdf$Gene, ]
newdf$annotation <- shortAno$name
return (newdf)
})
})
desresCol <- lapply(nameKey, function(listitem){
wordList <- as.list(names(desresSig[[listitem]]))
newdf <- mapply( function(df, w ) {words <- unlist(strsplit(w, "_to_", fixed=TRUE))
df <- cbind( df, "mutant"=rep(words[[1]], nrow(df)),
"comparedTo"=rep(words[[2]], nrow(df)))
}, desresSig[[listitem]], wordList, SIMPLIFY = FALSE, USE.NAMES = FALSE)
collated <- do.call(rbind, newdf)
newfile <- here::here("results", paste0("collated_sigRes_",listitem,".csv"))
write.csv(collated, file=newfile, row.names = FALSE)
return (collated)
})
source(here("scripts", "deseq_workflow_expanded_mk3.r"), local=TRUE, echo=FALSE)
rld <- lapply(setNames(nameKey, nameKey), function(listitem){
rlog(dds[[listitem]], blind=FALSE)
})
colors <- colorRampPalette( rev(brewer.pal(9, "Blues")) )(255)
sampleDists <- vector("list", 8)
sampleDists <- lapply(setNames(nameKey,nameKey), function(listitem){
sampleDists[[listitem]] <- dist(t(assay(rld[[listitem]])))
})
titles <- strsplit(nameKey, split = "_")
names(titles) <- nameKey
titles["Full_nochr3"][[2]]
View(titles)
titles["Full_nochr3"]
titles <- c("Full Data Set", "Full Data Set, without chromosome 3",
"TilS Subset", "TilS Subset, without chromosome 3",
"PPC Subset", "PPC Subset, without chromosome 3")
names(titles) <- nameKey
source(here("scripts", "deseq_workflow_expanded_mk3.r"), local=TRUE, echo=FALSE)
source(here("scripts", "deseq_workflow_expanded_mk3.r"), local=TRUE, echo=FALSE)
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
source(here("scripts", "deseq_workflow_expanded_mk3.r"), local=TRUE, echo=FALSE)
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
source(here("scripts", "deseq_workflow_expanded_mk3.r"), local=TRUE, echo=FALSE)
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.set(which = 2)
dev.copy(which = 4)
dev.off()
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.set(which = 2)
dev.copy(which = 4)
dev.off()
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.off()
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
pdf(file=here::here("results", "rld_all_clusterings.pdf"))
pheat <- lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.off()
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 20)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 20)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
dir.create(here::here("resutls", "topGenes_byVAriance_acrossDataset"))
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", "topGenes_byVariance_acrossDataset", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
dir.create(here::here("resutls", "topGenes_byVariance_acrossDataset"))
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 20)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
dir.create(here::here("results", "topGenes_byVariance_acrossDataset"))
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", "topGenes_byVariance_acrossDataset", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
dir.create(here::here("results", "rld_clustering"))
p
p
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
gpheat
dev.off
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
plot(gpheat)
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
lapply(gpheat, plot)
dev.off
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
lapply(gpheat, plot)
dev.off
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
lapply(gpheat, plot)
dev.off
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.list
dev.list()
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
View(pheat)
view(pheat)
pheat
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
pheat
dev.off
dev.list()
dev.off()
dev.off()
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 50)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
dir.create(here::here("results", "topGenes_byVariance_acrossDataset"))
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", "topGenes_byVariance_acrossDataset", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 50)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
dir.create(here::here("results", "topGenes_byVariance_acrossDataset"))
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", "topGenes_byVariance_acrossDataset", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
?dir.create
topVarGenes <- lapply(setNames(nameKey,nameKey), function(listitem){
head(order(rowVars(assay(rld[[listitem]])), decreasing = TRUE), 50)
})
topVarEntries <- vector("list", length(nameKey))
topVarEntries <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntries[[listitem]]  <- assay(rld[[listitem]])[ topVarGenes[[listitem]], ]
})
dir.create(here::here("results", "topGenes_byVariance_acrossDataset"), showWarnings = FALSE)
topVarEntriesAno <- vector("list", length(nameKey))
topVarEntriesAno <- lapply(setNames(nameKey, nameKey), function(listitem){
topVarEntriesAno[[listitem]] <- tibble::rownames_to_column(as.data.frame(topVarEntries[[listitem]]), var="locusTag")
shortAno <- anno_table[anno_table$locusTag %in% topVarEntriesAno[[listitem]]$locusTag, ]
topVarEntriesAno[[listitem]]$name <- shortAno$name
fname <- here::here("results", "topGenes_byVariance_acrossDataset", paste0("TopVarianceGenes_",listitem,".csv"))
write.csv(topVarEntriesAno[[listitem]], file=fname, row.names=FALSE)
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem)
dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 8, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 6, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 6, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 4, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 2, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 2, cellheight = 9, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 2, cellheight = 9, filename = fname)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 2, cellheight = 9, filename = fname, width = 8)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
# pdf(file=fname) # to save the pdf
pheatmap(mat, annotation_col = anno, main = listitem, fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname, width = 8)
# dev.off() # closes pdf
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname, width = 8)
})
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_AllPlots.pdf"))
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
dev.off()
gpheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
pdf(file=here::here("results", "topGenes_byVAriance_acrossDataset", "geneVarCluster_allPlots.pdf"))
lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
dev.off()
lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
pheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
pheat <- lapply(setNames(nameKey, nameKey), function(listitem){
mat  <- topVarEntries[[listitem]] - rowMeans(topVarEntries[[listitem]])
anno <- as.data.frame(colData(rld[[listitem]])[, c("strain","type")])
fname <- here::here("results", "topGenes_byVAriance_acrossDataset", paste0("geneVarCluster_", listitem, ".pdf"))
pheatmap(mat, annotation_col = anno, main = titles[[listitem]], fontsize_number = 2,
cellwidth = 12, cellheight = 9, filename = fname)
})
dir.create(here::here("results", "rld_clustering"))
pdf(file=here::here("results", "rld_clustering", "rld_all_clusterings.pdf"))
rldclusters <- lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.off()
dev.list()
dir.create(here::here("results", "rld_clustering"), showWarnings = FALSE)
pdf(file=here::here("results", "rld_clustering", "rld_all_clusterings.pdf"))
rldclusters <- lapply(nameKey, function(listitem){
fname <- here::here("results", paste0("rldclustering_", listitem, ".pdf"))
clustering_plot(sampleDists[[listitem]], rld[[listitem]], colors, titles[[listitem]], fname)
})
dev.off()
brewer.pal.info
sessionInfo()
mutantColors <- brewer.pal(8, "Set2")
names(mutantColors) <- levels(design_full$strain)
names(mutantColors) <- levels(allDesign$strain)
view(mutantColors)
dir.create(here::here("results","pca"), showWarnings = FALSE)
pcas <- lapply(setNames(nameKey,nameKey), function(listitem) {
pcaData <- plotPCA(rld[[listitem]], intgroup=c("strain", "type"), returnData=TRUE)
percentVar <- round(100 * attr(pcaData, "percentVar"))
fname <- here::here("results", "pca", paste0("pcaPlot_", listitem, ".pdf"))
p <- ggplot(pcaData, aes(PC1, PC2, color=strain, shape=type)) +
geom_point(size=3) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
coord_fixed() +
ggtitle(paste0("Principle Component Analysis, ",listitem)) +
theme(plot.title = element_text(hjust = 0.5)) +
scale_color_manual(values = mutantColors)
ggsave(fname, device = "pdf")
plot(p)
})
anno_table$gene_name <- paste(anno_table$locusTag, anno_table$name, sep="-")
pcaExplorer(dds = dds[["TilS"]], dst = rld[["TilS"]], coldata = tilSDesign, annotation = anno_table)
mutantColors <- brewer.pal(8, "Dark2")
names(mutantColors) <- levels(allDesign$strain)
dir.create(here::here("results","pca"), showWarnings = FALSE)
pcas <- lapply(setNames(nameKey,nameKey), function(listitem) {
pcaData <- plotPCA(rld[[listitem]], intgroup=c("strain", "type"), returnData=TRUE)
percentVar <- round(100 * attr(pcaData, "percentVar"))
fname <- here::here("results", "pca", paste0("pcaPlot_", listitem, ".pdf"))
p <- ggplot(pcaData, aes(PC1, PC2, color=strain, shape=type)) +
geom_point(size=3) +
xlab(paste0("PC1: ",percentVar[1],"% variance")) +
ylab(paste0("PC2: ",percentVar[2],"% variance")) +
coord_fixed() +
ggtitle(paste0("Principle Component Analysis, ",listitem)) +
theme(plot.title = element_text(hjust = 0.5)) +
scale_color_manual(values = mutantColors)
ggsave(fname, device = "pdf")
plot(p)
})
RColorBrewer::display.brewer.all()
